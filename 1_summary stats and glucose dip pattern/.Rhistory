###
rbind(mealx %>% summarise(y = mean(bg30m_dipYes), y2 = sum(bg30m_dipYes)) %>%
mutate(gp = "all") %>% select(gp, y, y2),
mealx %>% group_by(glycemic) %>% summarise(y = mean(bg30m_dipYes), y2 = sum(bg30m_dipYes)) %>%
rename(gp = "glycemic") %>% select(gp, y, y2),
mealx %>% group_by(bmi_gp) %>% summarise(y = mean(bg30m_dipYes), y2 = sum(bg30m_dipYes)) %>%
rename(gp = "bmi_gp") %>% select(gp, y, y2),
mealx %>% group_by(meal_timeBand3) %>% summarise(y = mean(bg30m_dipYes), y2 = sum(bg30m_dipYes)) %>%
rename(gp = "meal_timeBand3") %>% select(gp, y, y2)) %>% ungroup() %>%
mutate(out = glue("{y2} ({round(y*100)}%)")) %>% tempcsv()
pacman::p_load(tidyverse, skimr, glue, jialir, geepack,
ggpubr, viridisLite, patchwork, cowplot)
load("../0_rda/1.6_meal with cgm_935vids_add pre-postEMA-food-cohort etc_imp.rda")
#-------------------------------------------------------------------------------
# plot PGD pattern
#-------------------------------------------------------------------------------
# check bg30m_dipPctBaseGlu range to plot
quantile(mealx$bg30m_dipPctBaseGlu, seq(0, 1, 0.025)) # only plot the middle 2.5% to 97.5% range: xrange <- c(-50, 40)
#----- histogram of PGD magnitude and % below baseline
p1_meal_hist <- mealx %>% ggplot(aes(x = bg30m_dipPctBaseGlu, fill = factor(bg30m_dipYes))) +
geom_histogram(binwidth = 2) +
coord_cartesian(xlim = c(-50, 50), ylim = c(0, 420)) +
scale_x_continuous(breaks = seq(-40, 40, by = 20)) +
scale_y_continuous(breaks = seq(0, 400, by = 200)) +
labs(x = "Glucose dip magnitude (% baseline)", y = "Meal counts") +
scale_fill_manual(values = c("#1F9E89AF", "#0018877F"))+
# scale_fill_manual(values = c("#1F9E89AF", "#9F2F7FAA"))+
annotate("text",
x = 12.5, y = 330,
label = "54% meals with\nglucose dips \nbelow baseline",
# color = "#9F2F7FFF",
color = "#001887EF",
lineheight = 1,size = 6, hjust = 0) +
geom_vline(xintercept = 0, linetype = "longdash", linewidth = 0.8, color = "grey20") +
theme_cowplot() +
theme(legend.position = "none",
plot.margin = margin(0.5,0,0.5,0, "cm"),
axis.title.x = element_text(vjust = 0.1))
p1_meal_hist
#----- histogram of PGD magnitude and % below baseline
p1_meal_hist <- mealx %>% ggplot(aes(x = bg30m_dipPctBaseGlu, fill = factor(bg30m_dipYes))) +
geom_histogram(binwidth = 2) +
coord_cartesian(xlim = c(-50, 50), ylim = c(0, 420)) +
scale_x_continuous(breaks = seq(-40, 40, by = 20)) +
scale_y_continuous(breaks = seq(0, 400, by = 200)) +
labs(x = "Glucose dip magnitude (% baseline)", y = "Meal counts") +
scale_fill_manual(values = c("#1F9E89AF", "#0018877F"))+
# scale_fill_manual(values = c("#1F9E89AF", "#9F2F7FAA"))+
annotate("text",
x = 12.5, y = 330,
label = "54% with glucose \ndips below \n. baseline",
# color = "#9F2F7FFF",
color = "#001887EF",
lineheight = 1,size = 6, hjust = 0) +
geom_vline(xintercept = 0, linetype = "longdash", linewidth = 0.8, color = "grey20") +
theme_cowplot() +
theme(legend.position = "none",
plot.margin = margin(0.5,0,0.5,0, "cm"),
axis.title.x = element_text(vjust = 0.1))
p1_meal_hist
mealx %>% group_by(vid) %>% summarise(rate_pgd = mean(bg30m_dipYes)) %>% pull(rate_pgd) %>% table %>% prop.table()
dperson <- mealx %>% group_by(vid) %>% summarise(rate = mean(bg30m_dipYes)) %>% ungroup()
dperson %>% skim
# dperson <- dperson %>% mutate(gp = cut(rate, breaks = seq(0, 1, 0.2), include.lowest = T,
#                                        labels = c("[0 to 0.2]", "(0.2 to 0.4]", "(0.4 to 0.6]",
#                                                   "(0.6 to 0.8]", "(0.8 to 1]"))) %>%
# count(gp) %>% mutate(percent = n / sum(n) * 100, label = paste0(n, " (", round(percent, 0), "%)"))
dperson <- dperson %>% mutate(gp = cut(rate, breaks = seq(0, 1, 0.2), include.lowest = T,
labels = c("0-20%", "20-40%", "40-60%",
"60-80%", "80-100%"))) %>%
count(gp) %>% mutate(percent = n / sum(n) * 100, label = paste0(n, " (", round(percent, 0), "%)"))
p2_person <- dperson %>% ggplot(aes(x = gp, y = n, fill = gp %>% as.numeric())) +
geom_bar(stat = "identity") +
labs(x = "Personal proportion of meals with glucose dips below baseline", y = "Participant counts") +
scale_fill_gradient(low = "#0018873F", high = "#001887AF") +
# scale_fill_gradient(low = "#9F2F7F4F", high = "#9F2F7FCF") +
geom_text(aes(label = label), vjust = -0.5) +
coord_cartesian(ylim = c(0, 310)) +
theme_cowplot() +
theme(legend.position = "none",
axis.text.y = element_blank(),
theme(plot.margin = margin(0.5,0,0.5,0, "cm")),
axis.title.x = element_text(vjust = 0.1))
p2_person
#------------------------------------
# Combine plots --> 2.2_Figure
(p1_meal_hist + p2_person) +
plot_annotation(tag_levels = 'a', tag_suffix = ")") # export as 2.2_Figure.png with width = 1150, height = 400 (350 also can)
#----- histogram of PGD magnitude and % below baseline
p1_meal_hist <- mealx %>% ggplot(aes(x = bg30m_dipPctBaseGlu, fill = factor(bg30m_dipYes))) +
geom_histogram(binwidth = 2) +
coord_cartesian(xlim = c(-50, 50), ylim = c(0, 420)) +
scale_x_continuous(breaks = seq(-40, 40, by = 20)) +
scale_y_continuous(breaks = seq(0, 400, by = 200)) +
labs(x = "Glucose dip magnitude (% baseline)", y = "Meal counts") +
scale_fill_manual(values = c("#1F9E89AF", "#0018877F"))+
# scale_fill_manual(values = c("#1F9E89AF", "#9F2F7FAA"))+
annotate("text",
x = 12.5, y = 330,
label = "54% with glucose \ndips below baseline",
# color = "#9F2F7FFF",
color = "#001887EF",
lineheight = 1,size = 6, hjust = 0) +
geom_vline(xintercept = 0, linetype = "longdash", linewidth = 0.8, color = "grey20") +
theme_cowplot() +
theme(legend.position = "none",
plot.margin = margin(0.5,0,0.5,0, "cm"),
axis.title.x = element_text(vjust = 0.1))
p1_meal_hist
#----- histogram of personal PGD rate (# 53 personal fraction = 0; 98 personal fraction = 1)
mealx %>% group_by(vid) %>% summarise(rate_pgd = mean(bg30m_dipYes)) %>% pull(rate_pgd) %>% table %>% prop.table()
dperson <- mealx %>% group_by(vid) %>% summarise(rate = mean(bg30m_dipYes)) %>% ungroup()
dperson %>% skim
dperson <- dperson %>% mutate(gp = cut(rate, breaks = seq(0, 1, 0.2), include.lowest = T,
labels = c("0-20%", "20-40%", "40-60%",
"60-80%", "80-100%"))) %>%
count(gp) %>% mutate(percent = n / sum(n) * 100, label = paste0(n, " (", round(percent, 0), "%)"))
p2_person <- dperson %>% ggplot(aes(x = gp, y = n, fill = gp %>% as.numeric())) +
geom_bar(stat = "identity") +
labs(x = "Personal proportion of meals with glucose dips below baseline", y = "Participant counts") +
scale_fill_gradient(low = "#0018873F", high = "#001887AF") +
# scale_fill_gradient(low = "#9F2F7F4F", high = "#9F2F7FCF") +
geom_text(aes(label = label), vjust = -0.5) +
coord_cartesian(ylim = c(0, 310)) +
theme_cowplot() +
theme(legend.position = "none",
axis.text.y = element_blank(),
theme(plot.margin = margin(0.5,0,0.5,0, "cm")),
axis.title.x = element_text(vjust = 0.1))
p2_person
#------------------------------------
# Combine plots --> 2.2_Figure
(p1_meal_hist + p2_person) +
plot_annotation(tag_levels = 'a', tag_suffix = ")") # export as 2.2_Figure.png with width = 1150, height = 400 (350 also can)
#------------------------------------
#------------------------------------#------------------------------------
dtp <- mealx %>% group_by(vid) %>% summarise(rate = mean(bg30m_dipYes)*100) %>% ungroup() %>%
arrange(rate) %>% mutate(person = row_number())
quantile(dtp$rate, seq(0, 1, 0.25))
quantile(dtp$person, seq(0, 1, 0.25))
dtp %>% ggplot(aes(x = person, y = rate)) +
# geom_hline(yintercept = 0, color = "grey70", linetype = "longdash", size = 0.25) +
# geom_hline(yintercept = 36, color = "grey70", linetype = "longdash", size = 0.25) +
# geom_hline(yintercept = 50, color = "grey70", linetype = "longdash", size = 0.25) +
# geom_hline(yintercept = 72.7, color = "grey70", linetype = "longdash", size = 0.25) +
geom_hline(yintercept = 100, color = "grey70", linetype = "longdash", size = 0.25) +
geom_bar(stat = "identity", fill = "#0018873F", color = "#0018873F") +
# scale_fill_continuous() +
labs(x = "Participants sorted by personal proportion of meals\nwith glucose dips below baseline (n = 935)", y = "Personal proportion (%)") +
coord_cartesian(xlim = c(1, 935)) +
scale_x_continuous(breaks = c(1, 250, 500, 750, 935), expand = c(0, 0),
labels = c("1th", "250th", "500th", "750th", "935th")) +
scale_y_continuous(expand = c(0, 0)) +
theme_cowplot() +
theme(legend.position = "none",
panel.grid = element_blank(),
# axis.text.y = element_blank(),
plot.margin = margin(0.5,1,0.5,0.5, "cm"),
axis.title.x = element_text(vjust = 0.1))
pacman::p_load(tidyverse, skimr, glue, jialir, geepack,
ggpubr, viridisLite, patchwork, cowplot)
load("../0_rda/1.6_meal with cgm_935vids_add pre-postEMA-food-cohort etc_imp.rda")
#------------------------------------#------------------------------------
dtp <- mealx %>% group_by(vid) %>% summarise(rate = mean(bg30m_dipYes)*100) %>% ungroup() %>%
arrange(rate) %>% mutate(person = row_number())
quantile(dtp$rate, seq(0, 1, 0.25))
quantile(dtp$person, seq(0, 1, 0.25))
dtp %>% ggplot(aes(x = person, y = rate)) +
# geom_hline(yintercept = 0, color = "grey70", linetype = "longdash", size = 0.25) +
# geom_hline(yintercept = 36, color = "grey70", linetype = "longdash", size = 0.25) +
# geom_hline(yintercept = 50, color = "grey70", linetype = "longdash", size = 0.25) +
# geom_hline(yintercept = 72.7, color = "grey70", linetype = "longdash", size = 0.25) +
geom_hline(yintercept = 100, color = "grey70", linetype = "longdash", size = 0.25) +
geom_bar(stat = "identity", fill = "#0018873F", color = "#0018873F") +
# scale_fill_continuous() +
labs(x = "Participants sorted by personal proportion of meals\nwith glucose dips below baseline (n = 935)", y = "Personal proportion (%)") +
coord_cartesian(xlim = c(1, 935)) +
scale_x_continuous(breaks = c(1, 250, 500, 750, 935), expand = c(0, 0),
labels = c("1th", "250th", "500th", "750th", "935th")) +
scale_y_continuous(expand = c(0, 0)) +
theme_cowplot() +
theme(legend.position = "none",
panel.grid = element_blank(),
# axis.text.y = element_blank(),
plot.margin = margin(0.5,1,0.5,0.5, "cm"),
axis.title.x = element_text(vjust = 0.1))
pacman::p_load(tidyverse, skimr, glue, jialir, geepack,
ggpubr, viridisLite, patchwork, cowplot)
load("../0_rda/1.6_meal with cgm_935vids_add pre-postEMA-food-cohort etc_imp.rda")
#-------------------------------------------------------------------------------
# plot PGD pattern
#-------------------------------------------------------------------------------
# check bg30m_dipPctBaseGlu range to plot
quantile(mealx$bg30m_dipPctBaseGlu, seq(0, 1, 0.025)) # only plot the middle 2.5% to 97.5% range: xrange <- c(-50, 40)
#----- histogram of PGD magnitude and % below baseline
p1_meal_hist <- mealx %>% ggplot(aes(x = bg30m_dipPctBaseGlu, fill = factor(bg30m_dipYes))) +
geom_histogram(binwidth = 2) +
coord_cartesian(xlim = c(-50, 50), ylim = c(0, 420)) +
scale_x_continuous(breaks = seq(-40, 40, by = 20)) +
scale_y_continuous(breaks = seq(0, 400, by = 200)) +
labs(x = "Glucose dip magnitude (% baseline)", y = "Meal counts") +
scale_fill_manual(values = c("#1F9E89AF", "#0018877F"))+
# scale_fill_manual(values = c("#1F9E89AF", "#9F2F7FAA"))+
annotate("text",
x = 12.5, y = 330,
label = "54% with glucose \ndips below baseline",
# color = "#9F2F7FFF",
color = "#001887EF",
lineheight = 1,size = 6, hjust = 0) +
geom_vline(xintercept = 0, linetype = "longdash", linewidth = 0.8, color = "grey20") +
theme_cowplot() +
theme(legend.position = "none",
plot.margin = margin(0.5,0,0.5,0, "cm"),
axis.title.x = element_text(vjust = 0.1))
p1_meal_hist
#----- histogram of personal PGD rate (# 53 personal fraction = 0; 98 personal fraction = 1)
mealx %>% group_by(vid) %>% summarise(rate_pgd = mean(bg30m_dipYes)) %>% pull(rate_pgd) %>% table %>% prop.table()
dperson <- mealx %>% group_by(vid) %>% summarise(rate = mean(bg30m_dipYes)) %>% ungroup()
dperson %>% skim
# dperson <- dperson %>% mutate(gp = cut(rate, breaks = seq(0, 1, 0.2), include.lowest = T,
#                                        labels = c("[0 to 0.2]", "(0.2 to 0.4]", "(0.4 to 0.6]",
#                                                   "(0.6 to 0.8]", "(0.8 to 1]"))) %>%
# count(gp) %>% mutate(percent = n / sum(n) * 100, label = paste0(n, " (", round(percent, 0), "%)"))
dperson <- dperson %>% mutate(gp = cut(rate, breaks = seq(0, 1, 0.2), include.lowest = T,
labels = c("0-20%", "20-40%", "40-60%",
"60-80%", "80-100%"))) %>%
count(gp) %>% mutate(percent = n / sum(n) * 100, label = paste0(n, " (", round(percent, 0), "%)"))
p2_person <- dperson %>% ggplot(aes(x = gp, y = n, fill = gp %>% as.numeric())) +
geom_bar(stat = "identity") +
labs(x = "Within-person proportion of meals with glucose dips below baseline", y = "Participant counts") +
scale_fill_gradient(low = "#0018873F", high = "#001887AF") +
# scale_fill_gradient(low = "#9F2F7F4F", high = "#9F2F7FCF") +
geom_text(aes(label = label), vjust = -0.5) +
coord_cartesian(ylim = c(0, 310)) +
theme_cowplot() +
theme(legend.position = "none",
axis.text.y = element_blank(),
theme(plot.margin = margin(0.5,0,0.5,0, "cm")),
axis.title.x = element_text(vjust = 0.1))
p2_person
#------------------------------------
# Combine plots --> 2.2_Figure
(p1_meal_hist + p2_person) +
plot_annotation(tag_levels = 'a', tag_suffix = ")") # export as 2.2_Figure.png with width = 1150, height = 400 (350 also can)
#------------------------------------
#------------------------------------#------------------------------------
dtp <- mealx %>% group_by(vid) %>% summarise(rate = mean(bg30m_dipYes)*100) %>% ungroup() %>%
arrange(rate) %>% mutate(person = row_number())
quantile(dtp$rate, seq(0, 1, 0.25))
quantile(dtp$person, seq(0, 1, 0.25))
dtp %>% ggplot(aes(x = person, y = rate)) +
# geom_hline(yintercept = 0, color = "grey70", linetype = "longdash", size = 0.25) +
# geom_hline(yintercept = 36, color = "grey70", linetype = "longdash", size = 0.25) +
# geom_hline(yintercept = 50, color = "grey70", linetype = "longdash", size = 0.25) +
# geom_hline(yintercept = 72.7, color = "grey70", linetype = "longdash", size = 0.25) +
geom_hline(yintercept = 100, color = "grey70", linetype = "longdash", size = 0.25) +
geom_bar(stat = "identity", fill = "#0018873F", color = "#0018873F") +
# scale_fill_continuous() +
labs(x = "Participants sorted by within-person proportion of meals\nwith glucose dips below baseline (n = 935)", y = "Within-person proportion (%)") +
coord_cartesian(xlim = c(1, 935)) +
scale_x_continuous(breaks = c(1, 250, 500, 750, 935), expand = c(0, 0),
labels = c("1th", "250th", "500th", "750th", "935th")) +
scale_y_continuous(expand = c(0, 0)) +
theme_cowplot() +
theme(legend.position = "none",
panel.grid = element_blank(),
# axis.text.y = element_blank(),
plot.margin = margin(0.5,1,0.5,0.5, "cm"),
axis.title.x = element_text(vjust = 0.1))
pacman::p_load(tidyverse, skimr, glue, jialir, geepack,
ggpubr, viridisLite, patchwork, cowplot)
load("../0_rda/1.6_meal with cgm_935vids_add pre-postEMA-food-cohort etc_imp.rda")
#-------------------------------------------------------------------------------
# plot PGD pattern
#-------------------------------------------------------------------------------
# check bg30m_dipPctBaseGlu range to plot
quantile(mealx$bg30m_dipPctBaseGlu, seq(0, 1, 0.025)) # only plot the middle 2.5% to 97.5% range: xrange <- c(-50, 40)
#----- histogram of PGD magnitude and % below baseline
p1_meal_hist <- mealx %>% ggplot(aes(x = bg30m_dipPctBaseGlu, fill = factor(bg30m_dipYes))) +
geom_histogram(binwidth = 2) +
coord_cartesian(xlim = c(-50, 50), ylim = c(0, 420)) +
scale_x_continuous(breaks = seq(-40, 40, by = 20)) +
scale_y_continuous(breaks = seq(0, 400, by = 200)) +
labs(x = "Glucose dip magnitude (% baseline)", y = "Meal counts") +
scale_fill_manual(values = c("#1F9E89AF", "#0018877F"))+
# scale_fill_manual(values = c("#1F9E89AF", "#9F2F7FAA"))+
annotate("text",
x = 12.5, y = 330,
label = "54% with glucose \ndips below baseline",
# color = "#9F2F7FFF",
color = "#001887EF",
lineheight = 1,size = 6, hjust = 0) +
geom_vline(xintercept = 0, linetype = "longdash", linewidth = 0.8, color = "grey20") +
theme_cowplot() +
theme(legend.position = "none",
plot.margin = margin(0.5,0,0.5,0, "cm"),
axis.title.x = element_text(vjust = 0.1))
p1_meal_hist
#----- histogram of personal PGD rate (# 53 personal fraction = 0; 98 personal fraction = 1)
mealx %>% group_by(vid) %>% summarise(rate_pgd = mean(bg30m_dipYes)) %>% pull(rate_pgd) %>% table %>% prop.table()
dperson <- mealx %>% group_by(vid) %>% summarise(rate = mean(bg30m_dipYes)) %>% ungroup()
dperson %>% skim
# dperson <- dperson %>% mutate(gp = cut(rate, breaks = seq(0, 1, 0.2), include.lowest = T,
#                                        labels = c("[0 to 0.2]", "(0.2 to 0.4]", "(0.4 to 0.6]",
#                                                   "(0.6 to 0.8]", "(0.8 to 1]"))) %>%
# count(gp) %>% mutate(percent = n / sum(n) * 100, label = paste0(n, " (", round(percent, 0), "%)"))
dperson <- dperson %>% mutate(gp = cut(rate, breaks = seq(0, 1, 0.2), include.lowest = T,
labels = c("0-20%", "20-40%", "40-60%",
"60-80%", "80-100%"))) %>%
count(gp) %>% mutate(percent = n / sum(n) * 100, label = paste0(n, " (", round(percent, 0), "%)"))
p2_person <- dperson %>% ggplot(aes(x = gp, y = n, fill = gp %>% as.numeric())) +
geom_bar(stat = "identity") +
labs(x = "Within-person proportion of meals with glucose dips below baseline", y = "Participant counts") +
scale_fill_gradient(low = "#0018873F", high = "#001887AF") +
# scale_fill_gradient(low = "#9F2F7F4F", high = "#9F2F7FCF") +
geom_text(aes(label = label), vjust = -0.5) +
coord_cartesian(ylim = c(0, 310)) +
theme_cowplot() +
theme(legend.position = "none",
axis.text.y = element_blank(),
theme(plot.margin = margin(0.5,0,0.5,0, "cm")),
axis.title.x = element_text(vjust = 0.1))
p2_person
#------------------------------------
# Combine plots --> 2.2_Figure
(p1_meal_hist + p2_person) +
plot_annotation(tag_levels = 'a', tag_suffix = ")") # export as 2.2_Figure.png with width = 1200, height = 400 (350 also can)
#------------------------------------
# Combine plots --> 2.2_Figure
(p1_meal_hist + p2_person) +
plot_layout(widths = c(45, 55)) +
plot_annotation(tag_levels = 'a', tag_suffix = ")") # export as 2.2_Figure.png with width = 1150, height = 400 (350 also can)
#------------------------------------
# Combine plots --> 2.2_Figure
(p1_meal_hist + p2_person) +
plot_layout(widths = c(49, 51)) +
plot_annotation(tag_levels = 'a', tag_suffix = ")") # export as 2.2_Figure.png with width = 1150, height = 400 (350 also can)
#----- histogram of PGD magnitude and % below baseline
p1_meal_hist <- mealx %>% ggplot(aes(x = bg30m_dipPctBaseGlu, fill = factor(bg30m_dipYes))) +
geom_histogram(binwidth = 2) +
coord_cartesian(xlim = c(-50, 50), ylim = c(0, 420)) +
scale_x_continuous(breaks = seq(-40, 40, by = 20)) +
scale_y_continuous(breaks = seq(0, 400, by = 200)) +
labs(x = "Glucose dip magnitude (% baseline)", y = "Meal counts") +
scale_fill_manual(values = c("#1F9E89AF", "#0018877F"))+
# scale_fill_manual(values = c("#1F9E89AF", "#9F2F7FAA"))+
annotate("text",
x = 12.5, y = 330,
label = "54% with glucose \ndips below baseline",
# color = "#9F2F7FFF",
color = "#001887EF",
lineheight = 1,size = 5.5, hjust = 0) +
geom_vline(xintercept = 0, linetype = "longdash", linewidth = 0.8, color = "grey20") +
theme_cowplot() +
theme(legend.position = "none",
plot.margin = margin(0.5,0,0.5,0, "cm"),
axis.title.x = element_text(vjust = 0.1))
p1_meal_hist
#------------------------------------
# Combine plots --> 2.2_Figure
(p1_meal_hist + p2_person) +
plot_layout(widths = c(49, 51)) +
plot_annotation(tag_levels = 'a', tag_suffix = ")") # export as 2.2_Figure.png with width = 1150, height = 400 (350 also can)
#----- histogram of PGD magnitude and % below baseline
p1_meal_hist <- mealx %>% ggplot(aes(x = bg30m_dipPctBaseGlu, fill = factor(bg30m_dipYes))) +
geom_histogram(binwidth = 2) +
coord_cartesian(xlim = c(-50, 50), ylim = c(0, 420)) +
scale_x_continuous(breaks = seq(-40, 40, by = 20)) +
scale_y_continuous(breaks = seq(0, 400, by = 200)) +
labs(x = "Glucose dip magnitude (% baseline)", y = "Meal counts") +
scale_fill_manual(values = c("#1F9E89AF", "#0018877F"))+
# scale_fill_manual(values = c("#1F9E89AF", "#9F2F7FAA"))+
annotate("text",
x = 12.55, y = 330,
label = "54% with glucose \ndips below baseline",
# color = "#9F2F7FFF",
color = "#001887EF",
lineheight = 1,size = 5.5, hjust = 0) +
geom_vline(xintercept = 0, linetype = "longdash", linewidth = 0.8, color = "grey20") +
theme_cowplot() +
theme(legend.position = "none",
plot.margin = margin(0.5,0,0.5,0, "cm"),
axis.title.x = element_text(vjust = 0.1))
p1_meal_hist
#------------------------------------
# Combine plots --> 2.2_Figure
(p1_meal_hist + p2_person) +
plot_layout(widths = c(49, 51)) +
plot_annotation(tag_levels = 'a', tag_suffix = ")") # export as 2.2_Figure.png with width = 1150, height = 400 (350 also can)
#----- histogram of PGD magnitude and % below baseline
p1_meal_hist <- mealx %>% ggplot(aes(x = bg30m_dipPctBaseGlu, fill = factor(bg30m_dipYes))) +
geom_histogram(binwidth = 2) +
coord_cartesian(xlim = c(-50, 50), ylim = c(0, 420)) +
scale_x_continuous(breaks = seq(-40, 40, by = 20)) +
scale_y_continuous(breaks = seq(0, 400, by = 200)) +
labs(x = "Glucose dip magnitude (% baseline)", y = "Meal counts") +
scale_fill_manual(values = c("#1F9E89AF", "#0018877F"))+
# scale_fill_manual(values = c("#1F9E89AF", "#9F2F7FAA"))+
annotate("text",
x = 12.8, y = 330,
label = "54% with glucose \ndips below baseline",
# color = "#9F2F7FFF",
color = "#001887EF",
lineheight = 1,size = 5.5, hjust = 0) +
geom_vline(xintercept = 0, linetype = "longdash", linewidth = 0.8, color = "grey20") +
theme_cowplot() +
theme(legend.position = "none",
plot.margin = margin(0.5,0,0.5,0, "cm"),
axis.title.x = element_text(vjust = 0.1))
#------------------------------------
# Combine plots --> 2.2_Figure
(p1_meal_hist + p2_person) +
plot_layout(widths = c(49, 51)) +
plot_annotation(tag_levels = 'a', tag_suffix = ")") # export as 2.2_Figure.png with width = 1150, height = 400 (350 also can)
pacman::p_load(tidyverse, skimr, glue, jialir, geepack,
ggpubr, viridisLite, patchwork, cowplot)
load("../0_rda/1.6_meal with cgm_935vids_add pre-postEMA-food-cohort etc_imp.rda")
#-------------------------------------------------------------------------------
# plot PGD pattern
#-------------------------------------------------------------------------------
#----- histogram of PGD magnitude and % below baseline
p1_meal_hist <- mealx %>% ggplot(aes(x = bg30m_dipPctBaseGlu, fill = factor(bg30m_dipYes))) +
geom_histogram(binwidth = 2) +
coord_cartesian(xlim = c(-50, 50), ylim = c(0, 420)) +
scale_x_continuous(breaks = seq(-40, 40, by = 20)) +
scale_y_continuous(breaks = seq(0, 400, by = 200)) +
labs(x = "Glucose dip magnitude (% baseline)", y = "Meal counts") +
scale_fill_manual(values = c("#1F9E89AF", "#0018877F"))+
# scale_fill_manual(values = c("#1F9E89AF", "#9F2F7FAA"))+
annotate("text",
x = 12.8, y = 330,
label = "54% with glucose \ndips below baseline",
# color = "#9F2F7FFF",
color = "#001887EF",
lineheight = 1,size = 5.5, hjust = 0) +
geom_vline(xintercept = 0, linetype = "longdash", linewidth = 0.8, color = "grey20") +
theme_cowplot() +
theme(legend.position = "none",
plot.margin = margin(0.5,0,0.5,0, "cm"),
axis.title.x = element_text(vjust = 0.1))
load("../0_rda/1.6_meal with cgm_935vids_add pre-postEMA-food-cohort etc_imp.rda")
load("../../0_rda/1.6_meal with cgm_935vids_add pre-postEMA-food-cohort etc_imp.rda")
#-------------------------------------------------------------------------------
# plot PGD pattern
#-------------------------------------------------------------------------------
#----- histogram of PGD magnitude and % below baseline
p1_meal_hist <- mealx %>% ggplot(aes(x = bg30m_dipPctBaseGlu, fill = factor(bg30m_dipYes))) +
geom_histogram(binwidth = 2) +
coord_cartesian(xlim = c(-50, 50), ylim = c(0, 420)) +
scale_x_continuous(breaks = seq(-40, 40, by = 20)) +
scale_y_continuous(breaks = seq(0, 400, by = 200)) +
labs(x = "Glucose dip magnitude (% baseline)", y = "Meal counts") +
scale_fill_manual(values = c("#1F9E89AF", "#0018877F"))+
# scale_fill_manual(values = c("#1F9E89AF", "#9F2F7FAA"))+
annotate("text",
x = 12.8, y = 330,
label = "54% with glucose \ndips below baseline",
# color = "#9F2F7FFF",
color = "#001887EF",
lineheight = 1,size = 5.5, hjust = 0) +
geom_vline(xintercept = 0, linetype = "longdash", linewidth = 0.8, color = "grey20") +
theme_cowplot() +
theme(legend.position = "none",
plot.margin = margin(0.5,0,0.5,0, "cm"),
axis.title.x = element_text(vjust = 0.1))
p1_meal_hist
#----- histogram of personal PGD rate (# 53 personal fraction = 0; 98 personal fraction = 1)
mealx %>% group_by(vid) %>% summarise(rate_pgd = mean(bg30m_dipYes)) %>% pull(rate_pgd) %>% table %>% prop.table()
dperson <- mealx %>% group_by(vid) %>% summarise(rate = mean(bg30m_dipYes)) %>% ungroup()
dperson %>% skim
dperson <- dperson %>% mutate(gp = cut(rate, breaks = seq(0, 1, 0.2), include.lowest = T,
labels = c("0-20%", "20-40%", "40-60%","60-80%", "80-100%"))) %>%
count(gp) %>% mutate(percent = n / sum(n) * 100, label = paste0(n, " (", round(percent, 0), "%)"))
dperson
p2_person <- dperson %>% ggplot(aes(x = gp, y = n, fill = gp %>% as.numeric())) +
geom_bar(stat = "identity") +
labs(x = "Within-person proportion of meals with glucose dips below baseline", y = "Participant counts") +
scale_fill_gradient(low = "#0018873F", high = "#001887AF") +
# scale_fill_gradient(low = "#9F2F7F4F", high = "#9F2F7FCF") +
geom_text(aes(label = label), vjust = -0.5) +
coord_cartesian(ylim = c(0, 310)) +
theme_cowplot() +
theme(legend.position = "none",
axis.text.y = element_blank(),
theme(plot.margin = margin(0.5,0,0.5,0, "cm")),
axis.title.x = element_text(vjust = 0.1))
p2_person
#------------------------------------
#------------------------------------#------------------------------------
dtp <- mealx %>% group_by(vid) %>% summarise(rate = mean(bg30m_dipYes)*100) %>% ungroup() %>%
arrange(rate) %>% mutate(person = row_number())
quantile(dtp$rate, seq(0, 1, 0.25))
quantile(dtp$person, seq(0, 1, 0.25))
dtp %>% ggplot(aes(x = person, y = rate)) +
# geom_hline(yintercept = 0, color = "grey70", linetype = "longdash", size = 0.25) +
# geom_hline(yintercept = 36, color = "grey70", linetype = "longdash", size = 0.25) +
# geom_hline(yintercept = 50, color = "grey70", linetype = "longdash", size = 0.25) +
# geom_hline(yintercept = 72.7, color = "grey70", linetype = "longdash", size = 0.25) +
geom_hline(yintercept = 100, color = "grey70", linetype = "longdash", size = 0.25) +
geom_bar(stat = "identity", fill = "#0018873F", color = "#0018873F") +
# scale_fill_continuous() +
labs(x = "Participants sorted by within-person proportion of meals\nwith glucose dips below baseline (n = 935)", y = "Within-person proportion (%)") +
coord_cartesian(xlim = c(1, 935)) +
scale_x_continuous(breaks = c(1, 250, 500, 750, 935), expand = c(0, 0),
labels = c("1th", "250th", "500th", "750th", "935th")) +
scale_y_continuous(expand = c(0, 0)) +
theme_cowplot() +
theme(legend.position = "none",
panel.grid = element_blank(),
# axis.text.y = element_blank(),
plot.margin = margin(0.5,1,0.5,0.5, "cm"),
axis.title.x = element_text(vjust = 0.1))
