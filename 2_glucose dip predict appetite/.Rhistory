scale_y_continuous(breaks = bk1, labels = bkt1) +
geom_text(data = filter(dtDipM1, yVariable == "nextMeal_hrLater_min"), aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4, fontface = "bold") +
geom_text(data = filter(dtDipM1, yVariable == "nextMealOrSnack_hrLater_min"), aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4) +
scale_color_manual(values = color_model) +
# labs(y="", x= "", subtitle = "Glucose dip magnitude\n(10% baseline)", color = "") +
labs(y="", x= "", color = "") +
theme_cowplot(font_size = 16) +
theme(legend.position = "null",
plot.subtitle = element_text(face = "plain", hjust = 0.5, size = 14),
axis.text.y = element_text(size = 14),
plot.margin = margin(1,0,0,0, "cm")
# plot.margin = margin(0.5,0,0,0, "cm")
)
pM1
pB1 <- dtDipB1 %>%  ggplot(aes(x = estimate, y = y)) +
geom_rect(data = dtDipB1 %>% group_by(yVariable)%>% summarise_at(vars(estimate, y), mean) %>% ungroup(),
aes(xmin = -Inf, xmax = Inf, ymin = y - 0.75, max = y + 0.75),
linetype = "dotted", linewidth = 0.3, fill = "white", color = "gray50") +
geom_vline(xintercept = 0, colour = "#0018875F", linewidth = 0.5, linetype = "longdash") +
geom_pointrange(aes(x = estimate, xmin = conf.low, xmax = conf.high, color = Model),fatten = 4, shape = 15) +
coord_cartesian(xlim =c(-40, 0.5), ylim = c(0, 3)) +
scale_x_continuous(breaks = seq(-40, 1, by = 10)) +
scale_y_continuous(breaks = tpy1a$y2, labels = tpy1a$yLabel) +
geom_text(data = filter(dtDipB1, yVariable == "nextMeal_hrLater_min"), aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4, fontface = "bold") +
geom_text(data = filter(dtDipB1, yVariable == "nextMealOrSnack_hrLater_min"), aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4) +
scale_color_manual(values = color_model) +
# labs(y="", x= "", subtitle = "Glucose dip below baseline", color = "") +
labs(y="", x= "", color = "") +
theme_cowplot(font_size = 16) +
theme(legend.position = "null",
axis.text.y = element_blank(),
# plot.subtitle = element_text(face = "plain", hjust = 0.5, size = 14),
# plot.margin = margin(0.5,0.5,0,0, "cm")
plot.margin = margin(1,0.5,0,0, "cm")
)
pB1
# hunger etc
#----------------------------------#
tpy2 <- dat_plot %>% select(Model, yVariable, yLabel) %>% filter(!yVariable %in% c("nextMeal_hrLater_min", "nextMealOrSnack_hrLater_min")) %>%
mutate(yVariable = factor(yVariable, levels = c("hungry_post23h", "hungry_diff23h", "hungry_post34h", "hungry_diff34h"))) %>%
distinct() %>% arrange(desc(yVariable), desc(Model)) %>%
mutate(y = row_number() + (as.numeric(rev(yVariable))-1)*1) %>% mutate(y = y*barheight)
tpy2a <- tpy2 %>% select(yLabel, y) %>% group_by(yLabel) %>% summarise(y2 = mean(y)) %>% ungroup()
bk2 <- tpy2a$y2
bkt2 <- c(expression(bold("Hunger increase at 2-3 h")), expression(bold("Hunger increase at 3-4 h")),
"Hunger level at 2-3 h", "Hunger level at 3-4 h")
#
dtDipM2 <- dat_plot %>% filter(xVariable == "bg30m_dipPctBaseGlu_10", !yVariable %in% c("nextMeal_hrLater_min", "nextMealOrSnack_hrLater_min")) %>%
left_join(tpy2, by = c("yVariable", "Model", "yLabel")) %>% arrange(yVariable)
dtDipB2 <- dat_plot %>% filter(xVariable == "bg30m_dipYes", !yVariable %in% c("nextMeal_hrLater_min", "nextMealOrSnack_hrLater_min")) %>%
left_join(tpy2, by = c("yVariable", "Model", "yLabel")) %>% arrange(yVariable)
#
pM2 <- dtDipM2 %>% ggplot(aes(x = estimate, y = y)) +
geom_rect(data = dtDipM2 %>% group_by(yVariable)%>% summarise_at(vars(estimate, y), mean) %>% ungroup(),
aes(xmin = -Inf, xmax = Inf, ymin = y - 0.75, max = y + 0.75),
linetype = "dotted", linewidth = 0.3, fill = "white", color = "gray50") +
geom_vline(xintercept = 0, colour = "#0018875F", linewidth = 0.5, linetype = "longdash") +
geom_pointrange(aes(x = estimate, xmin = conf.low, xmax = conf.high, color = Model),fatten = 4, shape = 15) +
coord_cartesian(xlim =c(-0.02, 0.2), ylim = c(0, 6)) +
scale_x_continuous(breaks = seq(0, 0.2, by = 0.1)) +
scale_y_continuous(breaks = bk2, labels = bkt2) +
geom_text(data = filter(dtDipM2, yVariable %in% c("hungry_diff23h", "hungry_diff34h")),
aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4, fontface = "bold") +
geom_text(data = filter(dtDipM2, !yVariable %in% c("hungry_diff23h", "hungry_diff34h")),
aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4) +
scale_color_manual(values = color_model) +
labs(y="", x= "", title = "", subtitle = "Glucose dip magnitude\n(10% baseline)", color = "") +
theme_cowplot(font_size = 16) +
theme(legend.position = "null",
plot.title = element_text(face = "plain", hjust = 0.5),
plot.subtitle = element_text(face = "plain", hjust = 0.5, size = 14),
axis.text.y = element_text(size = 14),
# plot.margin = margin(1,0,0.5,0, "cm")
plot.margin = margin(0,0,0.5,0, "cm")
)
pM2
pB2 <- dtDipB2 %>%  ggplot(aes(x = estimate, y = y)) +
geom_rect(data = dtDipB2 %>% group_by(yVariable)%>% summarise_at(vars(estimate, y), mean) %>% ungroup(),
aes(xmin = -Inf, xmax = Inf, ymin = y - 0.75, max = y + 0.75),
linetype = "dotted", linewidth = 0.3, fill = "white", color = "gray50") +
geom_vline(xintercept = 0, colour = "#0018875F", linewidth = 0.5, linetype = "longdash") +
geom_pointrange(aes(x = estimate, xmin = conf.low, xmax = conf.high, color = Model),fatten = 4, shape = 15) +
coord_cartesian(xlim =c(-0.06, 0.6), ylim = c(0, 6)) +
scale_x_continuous(breaks = seq(0, 0.6, by = 0.2)) +
scale_y_continuous(breaks = tpy1a$y2, labels = tpy1a$yLabel) +
geom_text(data = filter(dtDipB2, yVariable %in% c("hungry_diff23h", "hungry_diff34h")),
aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4, fontface = "bold") +
geom_text(data = filter(dtDipB2, !yVariable %in% c("hungry_diff23h", "hungry_diff34h")),
aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4) +
scale_color_manual(values = color_model) +
labs(y="", x= "", title = "", subtitle = "Glucose dip below baseline\n(yes vs. no)", color = "") +
theme_cowplot(font_size = 16) +
theme(legend.position = "null",
axis.text.y = element_blank(),
plot.title = element_text(face = "plain", hjust = 0.5),
plot.subtitle = element_text(face = "plain", hjust = 0.5, size = 16),
# plot.margin = margin(1,0.5,0.5,0, "cm")
plot.margin = margin(0,0.5,0.5,0, "cm")
)
pB2
px_legend <- dtDipB2 %>%  ggplot(aes(x = estimate, y = y)) +
geom_pointrange(aes(x = estimate, xmin = conf.low, xmax = conf.high, color = Model),fatten = 4, shape = 15) +
# scale_color_manual(values = color_model) +
scale_color_manual(values = color_model, labels = c("Overall association (by the main model)", "Within-person association")) +
# labs(y="", x = "", color = "Association Types: ") +
labs(y="", x = "", color = "") +
theme_cowplot(font_size = 16) +
theme(
legend.position = c(0.015, 1.1),
legend.direction = "horizontal",
legend.justification = c("left", "bottom"),
legend.text = element_text(size = 14))
p_legend <- get_legend(px_legend + theme(legend.margin = margin(t = -5, r = 0, b = -0.3, l = 0, "cm")))
#----------------------
pGEEbind0 <- plot_spacer() / p_legend / (pM2 + pB2) / plot_spacer() / (pM1 + pB1) +
plot_layout(heights = c(0, 0.02, 5, -.99, 2.5))
pGEEbind <- plot_grid(pGEEbind0) +
draw_label(expression(beta ~ " coefficient (95% CI)"), x = 0.65,
y = 0.005, fontface = "bold", size = 16, hjust = 0.5)
pGEEbind <- plot_spacer() + pGEEbind + plot_layout(widths = c(-0.5, 5)) +
plot_annotation(theme = theme(plot.margin = margin(0, 0, 0.5, 2, unit = "cm")))
pGEEbind
#-------------------------------------------------------------------------------
# combine all
#-------------------------------------------------------------------------------
png(filename = "3.2_Figure.png", width = 1050, height = 950, res = 72*1.35)
pGEEbind # .png of w 1050
dev.off()
pacman::p_load(tidyverse, skimr, glue, jialir, patchwork, paletteer, ggthemes,
ggsci, cowplot, ggstats, ggpubr, viridisLite)
#-------------------------------------------------------------------------------
# plot GEE results for all appetite (primary and secondary)
#-------------------------------------------------------------------------------
load("../0_rda/3.1_GEE associations for plots (main and within-person).rda") #
dat_plot
color_model <- c("#CD1076CF", "#0000CDCF")
barheight <- 0.5
# time to next food
#----------------------------------#
tpy1 <- dat_plot %>% select(Model, yVariable, yLabel) %>% filter(yVariable %in% c("nextMeal_hrLater_min", "nextMealOrSnack_hrLater_min")) %>%
mutate(yVariable = factor(yVariable, levels = c("nextMeal_hrLater_min", "nextMealOrSnack_hrLater_min"))) %>%
distinct() %>% arrange(desc(yVariable), desc(Model)) %>%
mutate(y = row_number() + (as.numeric(rev(yVariable))-1)*1) %>% mutate(y = y*barheight)
tpy1a <- tpy1 %>% select(yLabel, y) %>% group_by(yLabel) %>% summarise(y2 = mean(y)) %>% ungroup()
bk1 <- tpy1a$y2
bkt1 <- c("Time to next meal or snack, min", expression(bold("Time to next meal, min")))
#
dtDipM1 <- dat_plot %>% filter(xVariable == "bg30m_dipPctBaseGlu_10", yVariable %in% c("nextMeal_hrLater_min", "nextMealOrSnack_hrLater_min")) %>%
left_join(tpy1, by = c("yVariable", "Model", "yLabel")) %>% arrange(yVariable)
dtDipB1 <- dat_plot %>% filter(xVariable == "bg30m_dipYes", yVariable %in% c("nextMeal_hrLater_min", "nextMealOrSnack_hrLater_min")) %>%
left_join(tpy1, by = c("yVariable", "Model", "yLabel")) %>% arrange(yVariable)
#
pM1 <- dtDipM1 %>% ggplot(aes(x = estimate, y = y)) +
geom_rect(data = dtDipM1 %>% group_by(yVariable)%>% summarise_at(vars(estimate, y), mean) %>% ungroup(),
aes(xmin = -Inf, xmax = Inf, ymin = y - 0.75, max = y + 0.75),
linetype = "dotted", linewidth = 0.3, fill = "white", color = "gray50") +
geom_vline(xintercept = 0, colour = "#0018875F", linewidth = 0.5, linetype = "longdash") +
geom_pointrange(aes(x = estimate, xmin = conf.low, xmax = conf.high, color = Model),fatten = 4, shape = 15) +
coord_cartesian(xlim =c(-9, 0.5), ylim = c(0, 3)) +
scale_x_continuous(breaks = seq(-8, 1, by = 2)) +
scale_y_continuous(breaks = bk1, labels = bkt1) +
geom_text(data = filter(dtDipM1, yVariable == "nextMeal_hrLater_min"), aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4, fontface = "bold") +
geom_text(data = filter(dtDipM1, yVariable == "nextMealOrSnack_hrLater_min"), aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4) +
scale_color_manual(values = color_model) +
# labs(y="", x= "", subtitle = "Glucose dip magnitude\n(10% baseline)", color = "") +
labs(y="", x= "", color = "") +
theme_cowplot() +
theme(legend.position = "null",
plot.subtitle = element_text(face = "plain", hjust = 0.5, size = 14),
axis.text.y = element_text(size = 14),
plot.margin = margin(1,0,0,0, "cm")
# plot.margin = margin(0.5,0,0,0, "cm")
)
pM1
pB1 <- dtDipB1 %>%  ggplot(aes(x = estimate, y = y)) +
geom_rect(data = dtDipB1 %>% group_by(yVariable)%>% summarise_at(vars(estimate, y), mean) %>% ungroup(),
aes(xmin = -Inf, xmax = Inf, ymin = y - 0.75, max = y + 0.75),
linetype = "dotted", linewidth = 0.3, fill = "white", color = "gray50") +
geom_vline(xintercept = 0, colour = "#0018875F", linewidth = 0.5, linetype = "longdash") +
geom_pointrange(aes(x = estimate, xmin = conf.low, xmax = conf.high, color = Model),fatten = 4, shape = 15) +
coord_cartesian(xlim =c(-40, 0.5), ylim = c(0, 3)) +
scale_x_continuous(breaks = seq(-40, 1, by = 10)) +
scale_y_continuous(breaks = tpy1a$y2, labels = tpy1a$yLabel) +
geom_text(data = filter(dtDipB1, yVariable == "nextMeal_hrLater_min"), aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4, fontface = "bold") +
geom_text(data = filter(dtDipB1, yVariable == "nextMealOrSnack_hrLater_min"), aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4) +
scale_color_manual(values = color_model) +
# labs(y="", x= "", subtitle = "Glucose dip below baseline", color = "") +
labs(y="", x= "", color = "") +
theme_cowplot() +
theme(legend.position = "null",
axis.text.y = element_blank(),
# plot.subtitle = element_text(face = "plain", hjust = 0.5, size = 14),
# plot.margin = margin(0.5,0.5,0,0, "cm")
plot.margin = margin(1,0.5,0,0, "cm")
)
pB1
# hunger etc
#----------------------------------#
tpy2 <- dat_plot %>% select(Model, yVariable, yLabel) %>% filter(!yVariable %in% c("nextMeal_hrLater_min", "nextMealOrSnack_hrLater_min")) %>%
mutate(yVariable = factor(yVariable, levels = c("hungry_post23h", "hungry_diff23h", "hungry_post34h", "hungry_diff34h"))) %>%
distinct() %>% arrange(desc(yVariable), desc(Model)) %>%
mutate(y = row_number() + (as.numeric(rev(yVariable))-1)*1) %>% mutate(y = y*barheight)
tpy2a <- tpy2 %>% select(yLabel, y) %>% group_by(yLabel) %>% summarise(y2 = mean(y)) %>% ungroup()
bk2 <- tpy2a$y2
bkt2 <- c(expression(bold("Hunger increase at 2-3 h")), expression(bold("Hunger increase at 3-4 h")),
"Hunger level at 2-3 h", "Hunger level at 3-4 h")
#
dtDipM2 <- dat_plot %>% filter(xVariable == "bg30m_dipPctBaseGlu_10", !yVariable %in% c("nextMeal_hrLater_min", "nextMealOrSnack_hrLater_min")) %>%
left_join(tpy2, by = c("yVariable", "Model", "yLabel")) %>% arrange(yVariable)
dtDipB2 <- dat_plot %>% filter(xVariable == "bg30m_dipYes", !yVariable %in% c("nextMeal_hrLater_min", "nextMealOrSnack_hrLater_min")) %>%
left_join(tpy2, by = c("yVariable", "Model", "yLabel")) %>% arrange(yVariable)
#
pM2 <- dtDipM2 %>% ggplot(aes(x = estimate, y = y)) +
geom_rect(data = dtDipM2 %>% group_by(yVariable)%>% summarise_at(vars(estimate, y), mean) %>% ungroup(),
aes(xmin = -Inf, xmax = Inf, ymin = y - 0.75, max = y + 0.75),
linetype = "dotted", linewidth = 0.3, fill = "white", color = "gray50") +
geom_vline(xintercept = 0, colour = "#0018875F", linewidth = 0.5, linetype = "longdash") +
geom_pointrange(aes(x = estimate, xmin = conf.low, xmax = conf.high, color = Model),fatten = 4, shape = 15) +
coord_cartesian(xlim =c(-0.02, 0.2), ylim = c(0, 6)) +
scale_x_continuous(breaks = seq(0, 0.2, by = 0.1)) +
scale_y_continuous(breaks = bk2, labels = bkt2) +
geom_text(data = filter(dtDipM2, yVariable %in% c("hungry_diff23h", "hungry_diff34h")),
aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4, fontface = "bold") +
geom_text(data = filter(dtDipM2, !yVariable %in% c("hungry_diff23h", "hungry_diff34h")),
aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4) +
scale_color_manual(values = color_model) +
labs(y="", x= "", title = "", subtitle = "Glucose dip magnitude\n(10% baseline)", color = "") +
theme_cowplot() +
theme(legend.position = "null",
plot.title = element_text(face = "plain", hjust = 0.5),
plot.subtitle = element_text(face = "plain", hjust = 0.5, size = 14),
axis.text.y = element_text(size = 14),
# plot.margin = margin(1,0,0.5,0, "cm")
plot.margin = margin(0,0,0.5,0, "cm")
)
pM2
pB2 <- dtDipB2 %>%  ggplot(aes(x = estimate, y = y)) +
geom_rect(data = dtDipB2 %>% group_by(yVariable)%>% summarise_at(vars(estimate, y), mean) %>% ungroup(),
aes(xmin = -Inf, xmax = Inf, ymin = y - 0.75, max = y + 0.75),
linetype = "dotted", linewidth = 0.3, fill = "white", color = "gray50") +
geom_vline(xintercept = 0, colour = "#0018875F", linewidth = 0.5, linetype = "longdash") +
geom_pointrange(aes(x = estimate, xmin = conf.low, xmax = conf.high, color = Model),fatten = 4, shape = 15) +
coord_cartesian(xlim =c(-0.06, 0.6), ylim = c(0, 6)) +
scale_x_continuous(breaks = seq(0, 0.6, by = 0.2)) +
scale_y_continuous(breaks = tpy1a$y2, labels = tpy1a$yLabel) +
geom_text(data = filter(dtDipB2, yVariable %in% c("hungry_diff23h", "hungry_diff34h")),
aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4, fontface = "bold") +
geom_text(data = filter(dtDipB2, !yVariable %in% c("hungry_diff23h", "hungry_diff34h")),
aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4) +
scale_color_manual(values = color_model) +
labs(y="", x= "", title = "", subtitle = "Glucose dip below baseline\n(yes vs. no)", color = "") +
theme_cowplot() +
theme(legend.position = "null",
axis.text.y = element_blank(),
plot.title = element_text(face = "plain", hjust = 0.5),
plot.subtitle = element_text(face = "plain", hjust = 0.5, size = 15),
# plot.margin = margin(1,0.5,0.5,0, "cm")
plot.margin = margin(0,0.5,0.5,0, "cm")
)
pB2
px_legend <- dtDipB2 %>%  ggplot(aes(x = estimate, y = y)) +
geom_pointrange(aes(x = estimate, xmin = conf.low, xmax = conf.high, color = Model),fatten = 4, shape = 15) +
# scale_color_manual(values = color_model) +
scale_color_manual(values = color_model, labels = c("Overall association (by the main model)", "Within-person association")) +
# labs(y="", x = "", color = "Association Types: ") +
labs(y="", x = "", color = "") +
theme_cowplot() +
theme(
legend.position = c(0.015, 1.1),
legend.direction = "horizontal",
legend.justification = c("left", "bottom"),
legend.text = element_text(size = 14))
p_legend <- get_legend(px_legend + theme(legend.margin = margin(t = -5, r = 0, b = -0.3, l = 0, "cm")))
#----------------------
pGEEbind0 <- plot_spacer() / p_legend / (pM2 + pB2) / plot_spacer() / (pM1 + pB1) +
plot_layout(heights = c(0, 0.02, 5, -.99, 2.5))
pGEEbind <- plot_grid(pGEEbind0) +
draw_label(expression(beta ~ " coefficient (95% CI)"), x = 0.65,
y = 0.005, fontface = "bold", size = 16, hjust = 0.5)
pGEEbind <- plot_spacer() + pGEEbind + plot_layout(widths = c(-0.5, 5)) +
plot_annotation(theme = theme(plot.margin = margin(0, 0, 0.5, 2, unit = "cm")))
pGEEbind
#-------------------------------------------------------------------------------
# combine all
#-------------------------------------------------------------------------------
png(filename = "3.2_Figure.png", width = 1050, height = 950, res = 72*1.35)
pGEEbind # .png of w 1050
dev.off()
pGEEbind0 <- plot_spacer() / p_legend / (pM2 + pB2) / plot_spacer() / (pM1 + pB1) +
plot_layout(heights = c(0, 0.02, 5, -.99, 2.5))
pGEEbind <- plot_grid(pGEEbind0) +
draw_label(expression(beta ~ " coefficient (95% CI)"), x = 0.65,
y = 0.005, fontface = "bold", size = 18, hjust = 0.5)
pGEEbind <- plot_spacer() + pGEEbind + plot_layout(widths = c(-0.5, 5)) +
plot_annotation(theme = theme(plot.margin = margin(0, 0, 0.5, 2, unit = "cm")))
pGEEbind
#-------------------------------------------------------------------------------
# combine all
#-------------------------------------------------------------------------------
png(filename = "3.2_Figure.png", width = 1050, height = 950, res = 72*1.35)
pGEEbind # .png of w 1050
dev.off()
pacman::p_load(tidyverse, skimr, glue, jialir, patchwork, paletteer, ggthemes,
ggsci, cowplot, ggstats, ggpubr, viridisLite)
#-------------------------------------------------------------------------------
# plot GEE results for all appetite (primary and secondary)
#-------------------------------------------------------------------------------
load("../0_rda/3.1_GEE associations for plots (main and within-person).rda") #
dat_plot
color_model <- c("#CD1076CF", "#0000CDCF")
barheight <- 0.5
# time to next food
#----------------------------------#
tpy1 <- dat_plot %>% select(Model, yVariable, yLabel) %>% filter(yVariable %in% c("nextMeal_hrLater_min", "nextMealOrSnack_hrLater_min")) %>%
mutate(yVariable = factor(yVariable, levels = c("nextMeal_hrLater_min", "nextMealOrSnack_hrLater_min"))) %>%
distinct() %>% arrange(desc(yVariable), desc(Model)) %>%
mutate(y = row_number() + (as.numeric(rev(yVariable))-1)*1) %>% mutate(y = y*barheight)
tpy1a <- tpy1 %>% select(yLabel, y) %>% group_by(yLabel) %>% summarise(y2 = mean(y)) %>% ungroup()
bk1 <- tpy1a$y2
bkt1 <- c("Time to next meal or snack, min", expression(bold("Time to next meal, min")))
#
dtDipM1 <- dat_plot %>% filter(xVariable == "bg30m_dipPctBaseGlu_10", yVariable %in% c("nextMeal_hrLater_min", "nextMealOrSnack_hrLater_min")) %>%
left_join(tpy1, by = c("yVariable", "Model", "yLabel")) %>% arrange(yVariable)
dtDipB1 <- dat_plot %>% filter(xVariable == "bg30m_dipYes", yVariable %in% c("nextMeal_hrLater_min", "nextMealOrSnack_hrLater_min")) %>%
left_join(tpy1, by = c("yVariable", "Model", "yLabel")) %>% arrange(yVariable)
#
pM1 <- dtDipM1 %>% ggplot(aes(x = estimate, y = y)) +
geom_rect(data = dtDipM1 %>% group_by(yVariable)%>% summarise_at(vars(estimate, y), mean) %>% ungroup(),
aes(xmin = -Inf, xmax = Inf, ymin = y - 0.75, max = y + 0.75),
linetype = "dotted", linewidth = 0.3, fill = "white", color = "gray50") +
geom_vline(xintercept = 0, colour = "#0018875F", linewidth = 0.5, linetype = "longdash") +
geom_pointrange(aes(x = estimate, xmin = conf.low, xmax = conf.high, color = Model),fatten = 4, shape = 15) +
coord_cartesian(xlim =c(-9, 0.5), ylim = c(0, 3)) +
scale_x_continuous(breaks = seq(-8, 1, by = 2)) +
scale_y_continuous(breaks = bk1, labels = bkt1) +
geom_text(data = filter(dtDipM1, yVariable == "nextMeal_hrLater_min"), aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4, fontface = "bold") +
geom_text(data = filter(dtDipM1, yVariable == "nextMealOrSnack_hrLater_min"), aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4) +
scale_color_manual(values = color_model) +
# labs(y="", x= "", subtitle = "Glucose dip magnitude\n(10% baseline)", color = "") +
labs(y="", x= "", color = "") +
theme_cowplot() +
theme(legend.position = "null",
plot.subtitle = element_text(face = "plain", hjust = 0.5, size = 14),
axis.text.y = element_text(size = 14),
plot.margin = margin(1,0,0,0, "cm")
# plot.margin = margin(0.5,0,0,0, "cm")
)
pM1
pB1 <- dtDipB1 %>%  ggplot(aes(x = estimate, y = y)) +
geom_rect(data = dtDipB1 %>% group_by(yVariable)%>% summarise_at(vars(estimate, y), mean) %>% ungroup(),
aes(xmin = -Inf, xmax = Inf, ymin = y - 0.75, max = y + 0.75),
linetype = "dotted", linewidth = 0.3, fill = "white", color = "gray50") +
geom_vline(xintercept = 0, colour = "#0018875F", linewidth = 0.5, linetype = "longdash") +
geom_pointrange(aes(x = estimate, xmin = conf.low, xmax = conf.high, color = Model),fatten = 4, shape = 15) +
coord_cartesian(xlim =c(-40, 0.5), ylim = c(0, 3)) +
scale_x_continuous(breaks = seq(-40, 1, by = 10)) +
scale_y_continuous(breaks = tpy1a$y2, labels = tpy1a$yLabel) +
geom_text(data = filter(dtDipB1, yVariable == "nextMeal_hrLater_min"), aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4, fontface = "bold") +
geom_text(data = filter(dtDipB1, yVariable == "nextMealOrSnack_hrLater_min"), aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4) +
scale_color_manual(values = color_model) +
# labs(y="", x= "", subtitle = "Glucose dip below baseline", color = "") +
labs(y="", x= "", color = "") +
theme_cowplot() +
theme(legend.position = "null",
axis.text.y = element_blank(),
# plot.subtitle = element_text(face = "plain", hjust = 0.5, size = 14),
# plot.margin = margin(0.5,0.5,0,0, "cm")
plot.margin = margin(1,0.5,0,0, "cm")
)
pB1
# hunger etc
#----------------------------------#
tpy2 <- dat_plot %>% select(Model, yVariable, yLabel) %>% filter(!yVariable %in% c("nextMeal_hrLater_min", "nextMealOrSnack_hrLater_min")) %>%
mutate(yVariable = factor(yVariable, levels = c("hungry_post23h", "hungry_diff23h", "hungry_post34h", "hungry_diff34h"))) %>%
distinct() %>% arrange(desc(yVariable), desc(Model)) %>%
mutate(y = row_number() + (as.numeric(rev(yVariable))-1)*1) %>% mutate(y = y*barheight)
tpy2a <- tpy2 %>% select(yLabel, y) %>% group_by(yLabel) %>% summarise(y2 = mean(y)) %>% ungroup()
bk2 <- tpy2a$y2
bkt2 <- c(expression(bold("Hunger increase at 2-3 h")), expression(bold("Hunger increase at 3-4 h")),
"Hunger level at 2-3 h", "Hunger level at 3-4 h")
#
dtDipM2 <- dat_plot %>% filter(xVariable == "bg30m_dipPctBaseGlu_10", !yVariable %in% c("nextMeal_hrLater_min", "nextMealOrSnack_hrLater_min")) %>%
left_join(tpy2, by = c("yVariable", "Model", "yLabel")) %>% arrange(yVariable)
dtDipB2 <- dat_plot %>% filter(xVariable == "bg30m_dipYes", !yVariable %in% c("nextMeal_hrLater_min", "nextMealOrSnack_hrLater_min")) %>%
left_join(tpy2, by = c("yVariable", "Model", "yLabel")) %>% arrange(yVariable)
#
pM2 <- dtDipM2 %>% ggplot(aes(x = estimate, y = y)) +
geom_rect(data = dtDipM2 %>% group_by(yVariable)%>% summarise_at(vars(estimate, y), mean) %>% ungroup(),
aes(xmin = -Inf, xmax = Inf, ymin = y - 0.75, max = y + 0.75),
linetype = "dotted", linewidth = 0.3, fill = "white", color = "gray50") +
geom_vline(xintercept = 0, colour = "#0018875F", linewidth = 0.5, linetype = "longdash") +
geom_pointrange(aes(x = estimate, xmin = conf.low, xmax = conf.high, color = Model),fatten = 4, shape = 15) +
coord_cartesian(xlim =c(-0.02, 0.2), ylim = c(0, 6)) +
scale_x_continuous(breaks = seq(0, 0.2, by = 0.1)) +
scale_y_continuous(breaks = bk2, labels = bkt2) +
geom_text(data = filter(dtDipM2, yVariable %in% c("hungry_diff23h", "hungry_diff34h")),
aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4, fontface = "bold") +
geom_text(data = filter(dtDipM2, !yVariable %in% c("hungry_diff23h", "hungry_diff34h")),
aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4) +
scale_color_manual(values = color_model) +
labs(y="", x= "", title = "", subtitle = "Glucose dip magnitude\n(10% baseline)", color = "") +
theme_cowplot() +
theme(legend.position = "null",
plot.title = element_text(face = "plain", hjust = 0.5),
plot.subtitle = element_text(face = "plain", hjust = 0.5, size = 15),
axis.text.y = element_text(size = 14),
# plot.margin = margin(1,0,0.5,0, "cm")
plot.margin = margin(0,0,0.5,0, "cm")
)
pM2
pB2 <- dtDipB2 %>%  ggplot(aes(x = estimate, y = y)) +
geom_rect(data = dtDipB2 %>% group_by(yVariable)%>% summarise_at(vars(estimate, y), mean) %>% ungroup(),
aes(xmin = -Inf, xmax = Inf, ymin = y - 0.75, max = y + 0.75),
linetype = "dotted", linewidth = 0.3, fill = "white", color = "gray50") +
geom_vline(xintercept = 0, colour = "#0018875F", linewidth = 0.5, linetype = "longdash") +
geom_pointrange(aes(x = estimate, xmin = conf.low, xmax = conf.high, color = Model),fatten = 4, shape = 15) +
coord_cartesian(xlim =c(-0.06, 0.6), ylim = c(0, 6)) +
scale_x_continuous(breaks = seq(0, 0.6, by = 0.2)) +
scale_y_continuous(breaks = tpy1a$y2, labels = tpy1a$yLabel) +
geom_text(data = filter(dtDipB2, yVariable %in% c("hungry_diff23h", "hungry_diff34h")),
aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4, fontface = "bold") +
geom_text(data = filter(dtDipB2, !yVariable %in% c("hungry_diff23h", "hungry_diff34h")),
aes(y = y, label = pLabel2), nudge_y = 0.25, size = 4) +
scale_color_manual(values = color_model) +
labs(y="", x= "", title = "", subtitle = "Glucose dip below baseline\n(yes vs. no)", color = "") +
theme_cowplot() +
theme(legend.position = "null",
axis.text.y = element_blank(),
plot.title = element_text(face = "plain", hjust = 0.5),
plot.subtitle = element_text(face = "plain", hjust = 0.5, size = 15),
# plot.margin = margin(1,0.5,0.5,0, "cm")
plot.margin = margin(0,0.5,0.5,0, "cm")
)
pB2
px_legend <- dtDipB2 %>%  ggplot(aes(x = estimate, y = y)) +
geom_pointrange(aes(x = estimate, xmin = conf.low, xmax = conf.high, color = Model),fatten = 4, shape = 15) +
# scale_color_manual(values = color_model) +
scale_color_manual(values = color_model, labels = c("Overall association (by the main model)", "Within-person association")) +
# labs(y="", x = "", color = "Association Types: ") +
labs(y="", x = "", color = "") +
theme_cowplot() +
theme(
legend.position = c(0.015, 1.1),
legend.direction = "horizontal",
legend.justification = c("left", "bottom"),
legend.text = element_text(size = 14))
p_legend <- get_legend(px_legend + theme(legend.margin = margin(t = -5, r = 0, b = -0.3, l = 0, "cm")))
#----------------------
pGEEbind0 <- plot_spacer() / p_legend / (pM2 + pB2) / plot_spacer() / (pM1 + pB1) +
plot_layout(heights = c(0, 0.02, 5, -.99, 2.5))
pGEEbind <- plot_grid(pGEEbind0) +
draw_label(expression(beta ~ " coefficient (95% CI)"), x = 0.65,
y = 0.005, fontface = "bold", size = 18, hjust = 0.5)
pGEEbind <- plot_spacer() + pGEEbind + plot_layout(widths = c(-0.5, 5)) +
plot_annotation(theme = theme(plot.margin = margin(0, 0, 0.5, 2, unit = "cm")))
pGEEbind
#-------------------------------------------------------------------------------
# combine all
#-------------------------------------------------------------------------------
png(filename = "3.2_Figure.png", width = 1050, height = 950, res = 72*1.35)
pGEEbind # .png of w 1050
dev.off()
pacman::p_load(tidyverse, skimr, glue, jialir, geepack,broom)
load("../0_rda/1.6_meal with cgm_935vids_add pre-postEMA-food-cohort etc_imp.rda")
mealx <- mealx %>% mutate(bg30m_dipPctBaseGlu_10 = bg30m_dipPctBaseGlu/10, .after = bg30m_dipPctBaseGlu) %>%
mutate(nextMeal_hrLater_min = nextMeal_hrLater*60, nextMealOrSnack_hrLater_min = nextMealOrSnack_hrLater*60, .after = nextMealOrSnack_hrLater)
covList1 <- c("age", "gender", "ethnicity", "edu", "smoking", "alcohol", "bmi", "glycemic", "meal_timeBand3")
outvarF3num <- c("nextMeal_hrLater_min", "nextMealOrSnack_hrLater_min", "hungry_post23h", "hungry_diff23h")
outvarF4num <- c("hungry_post34h", "hungry_diff34h")
#--------
mealx %>% group_by(nextMeal_hrLater_min, vid, age, gender, ethnicity,edu, smoking, alcohol, bmi, glycemic) %>%
summarise(dip = mean(bg30m_dipPctBaseGlu_10)) %>% ungroup() %>% select(-vid) %>%
lm(nextMeal_hrLater_min~., data = .) %>% tidy
gc()
pacman::p_load(tidyverse, skimr, glue, jialir, geepack,broom)
load("../0_rda/1.6_meal with cgm_935vids_add pre-postEMA-food-cohort etc_imp.rda")
mealx <- mealx %>% mutate(bg30m_dipPctBaseGlu_10 = bg30m_dipPctBaseGlu/10, .after = bg30m_dipPctBaseGlu) %>%
mutate(nextMeal_hrLater_min = nextMeal_hrLater*60, nextMealOrSnack_hrLater_min = nextMealOrSnack_hrLater*60, .after = nextMealOrSnack_hrLater)
covList1 <- c("age", "gender", "ethnicity", "edu", "smoking", "alcohol", "bmi", "glycemic", "meal_timeBand3")
outvarF3num <- c("nextMeal_hrLater_min", "nextMealOrSnack_hrLater_min", "hungry_post23h", "hungry_diff23h")
outvarF4num <- c("hungry_post34h", "hungry_diff34h")
expoList <- c("bg30m_dipPctBaseGlu_10")
tpd_f3num <- expand.grid(outcomeList = outvarF3num, expoList = expoList, stringsAsFactors = F)
tpd_f4num <- expand.grid(outcomeList = outvarF4num, expoList = expoList, stringsAsFactors = F)
#---------------------------------- Main model
predict.fun <- function(dtm, outcome, exposure = "", varList) {
dtm <- dtm %>% select(vid, c(outcome, exposure, varList)) %>% na.omit %>% mutate(vid = factor(vid)) %>% arrange(vid)
fit <- eval(parse(text = glue("geeglm({outcome} ~ {paste(c({exposure}, {varList}), collapse = '+')}, id = vid, data = dtm)")))
fit %>% tidy(conf.int = T) %>%
mutate(Estimate_CI = est_ci(estimate, conf.low, conf.high, sep = ", ", digit = 2),
pvalue = p.value, yVariable = outcome) %>%
rename(xVariable = term) %>%
select(yVariable, xVariable, Estimate_CI, pvalue, everything()) %>%
select(-std.error, -statistic, -p.value) %>%
filter(grepl(exposure, xVariable))
}
# for dip <= baseline
outF3num <- map2(tpd_f3num$expoList, tpd_f3num$outcomeList, \(x, y) {
predict.fun(dtm = mealx %>% filter(bg30m_dipPctBaseGlu_10<=0), outcome = y, exposure = x, varList = covList1) }) %>% data.table::rbindlist()
outF4num <- map2(tpd_f4num$expoList, tpd_f4num$outcomeList, \(x, y) {
predict.fun(dtm = mealx %>% filter(nextMealOrSnack_hrLater>=4, bg30m_dipPctBaseGlu_10<=0), outcome = y, exposure = x, varList = covList1)}) %>% data.table::rbindlist()
outnum <- rbind(outF3num, outF4num) %>% arrange(xVariable)
outnum #%>% tempcsv()
outnum %>% tempcsv()
# for dip > baseline
outF3num <- map2(tpd_f3num$expoList, tpd_f3num$outcomeList, \(x, y) {
predict.fun(dtm = mealx %>% filter(bg30m_dipPctBaseGlu_10>0), outcome = y, exposure = x, varList = covList1) }) %>% data.table::rbindlist()
outF4num <- map2(tpd_f4num$expoList, tpd_f4num$outcomeList, \(x, y) {
predict.fun(dtm = mealx %>% filter(nextMealOrSnack_hrLater>=4, bg30m_dipPctBaseGlu_10>0), outcome = y, exposure = x, varList = covList1)}) %>% data.table::rbindlist()
outnum <- rbind(outF3num, outF4num) %>% arrange(xVariable)
outnum #%>% tempcsv()
outnum %>% tempcsv()
